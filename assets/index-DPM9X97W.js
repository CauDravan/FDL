(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function a(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=a(n);fetch(n.href,r)}})();const h={sheetId:"1j6RlyzBKN0WX_HsLL4J0mzzF1TzYauxok55dIKA1U2o",sheetName:"Level(Cd)",iconMap:{"-1":"lv1f","-2":"lv2f","-3":"lv3f","-46":"lvinf",P:"lvP",U:"lvU",R:"lvR"}};function G(e){if(e==null)return"src/assets/icons/lv_unknown.png";const t=String(e).trim();if(h.iconMap[t])return`src/assets/icons/${h.iconMap[t]}.png`;const a=parseFloat(t);return isNaN(a)?`src/assets/icons/lv${t}.png`:`src/assets/icons/lv${Math.floor(a)}.png`}function D(e){if(e==null)return 0;const t=String(e).replace(/[^\d\.\-]/g,""),a=parseFloat(t);return isNaN(a)?0:a}function w(e,t){const n=t/62.5;let r=0;const s=setInterval(()=>{r+=n,r>=t?(e.textContent=t.toLocaleString(),clearInterval(s)):e.textContent=Math.floor(r).toLocaleString()},16)}async function k(){try{const e=`https://opensheet.elk.sh/${h.sheetId}/${h.sheetName}`,t=await fetch(e);if(!t.ok)throw new Error(`HTTP ${t.status}`);const a=await t.json();if(!Array.isArray(a))throw new Error("Unexpected data format");return a}catch(e){throw console.error("Error loading data:",e),e}}function B(e){const t=new Set,a=new Set;let i=0;const n={};e.forEach(o=>{o.IDL&&t.add(String(o.IDL)),o.ID&&a.add(String(o.ID)),i+=D(o.Exp);const d=String(o.Genres||"").trim();(d===""?["#unknown"]:d.split(/[,;|]+/).map(c=>c.trim()).filter(Boolean)).forEach(c=>{n[c]||(n[c]={played:0,games:new Set,exp:0}),n[c].played+=1,o.ID&&n[c].games.add(String(o.ID)),n[c].exp+=D(o.Exp)})});const r=Object.keys(n).sort((o,d)=>n[d].exp-n[o].exp),s=r.length?r[0]:"â€”";return{totalRows:e.length,totalExp:Math.round(i),topGenre:s,totalUniqueGames:a.size,genreStats:n,sortedGenres:r}}function T(e){const t=document.createElement("div");t.className="relative bg-gradient-to-br from-zinc-900 to-zinc-950 border border-zinc-800 rounded-xl p-4 cursor-pointer transition-all duration-300 hover:border-pink-primary hover:shadow-lg hover:shadow-pink-primary/30 hover:-translate-y-0.5 group overflow-hidden",t.onclick=()=>{const u=e.IDL||"";window.location.href=`details.html?id=${encodeURIComponent(u)}`};const a=document.createElement("div");a.className="absolute inset-0 bg-gradient-to-br from-pink-primary/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300",t.appendChild(a);const i=document.createElement("div");i.className="absolute top-0 left-0 w-1 h-full bg-pink-primary scale-y-0 group-hover:scale-y-100 transition-transform duration-300 origin-top",t.appendChild(i);const n=document.createElement("div");n.className="relative flex items-start gap-3";const r=document.createElement("div");r.className="relative flex-shrink-0";const s=e.Level||e.BS,o=document.createElement("img");o.src=G(s),o.alt=s||"",o.className="w-12 h-12 rounded-lg shadow-lg",r.appendChild(o);const d=String(s).trim();if(["P","U","R"].includes(d)){const u=e.BS||e.Level;if(u!=null){const N=parseFloat(String(u).replace(/[^\d\.\-]/g,""));if(!isNaN(N)){const S=Math.floor(N),E=document.createElement("div");E.className="absolute -top-1.5 -left-1.5 w-6 h-6 bg-black rounded-full";const f=document.createElement("img");f.src=`src/assets/icons/lv${S}.png`,f.alt=S,f.className="w-full h-full rounded-full",E.appendChild(f),r.appendChild(E)}}}n.appendChild(r);const l=document.createElement("div");l.className="flex-1 min-w-0";const c=document.createElement("div");c.className="flex items-baseline gap-2 mb-1 flex-wrap";const p=document.createElement("span");p.className="text-xs font-semibold text-pink-secondary whitespace-nowrap",p.textContent=`#${e.ID||e.IDL||"-"} -`;const x=document.createElement("span");x.className="text-xs text-zinc-100 font-medium leading-tight",x.textContent=e.Game||e.IDL||"(unknown)",c.appendChild(p),c.appendChild(x);const y=document.createElement("div");return y.className="text-xs text-zinc-400 font-light leading-tight",y.textContent=e["Own Rate"]||e.Level||"-",l.appendChild(c),l.appendChild(y),n.appendChild(l),t.appendChild(n),t}function z(e){const t={totalRows:document.getElementById("totalRows"),totalExp:document.getElementById("totalExp"),topGenre:document.getElementById("topGenre"),totalUniqueGames:document.getElementById("totalUniqueGames")};t.totalRows&&w(t.totalRows,e.totalRows),t.totalExp&&w(t.totalExp,e.totalExp),t.topGenre&&(t.topGenre.textContent=e.topGenre),t.totalUniqueGames&&w(t.totalUniqueGames,e.totalUniqueGames)}function M(e,t){const a=document.getElementById("genreTable");a&&(a.innerHTML="",e.forEach(i=>{const n=t[i],r=document.createElement("div");r.className="grid grid-cols-[2.5fr_1fr_1fr_1.2fr] gap-3 px-3 py-3.5 bg-gradient-to-r from-pink-primary/5 to-pink-primary/2 border border-zinc-800 rounded-lg text-xs transition-all hover:border-pink-primary hover:bg-pink-primary/12 hover:translate-x-0.5 group relative overflow-hidden";const s=document.createElement("div");s.className="absolute top-0 left-0 w-0.5 h-full bg-gradient-to-b from-pink-primary to-pink-dark opacity-0 group-hover:opacity-100 transition-opacity",r.appendChild(s);const o=document.createElement("div");o.className="text-pink-secondary font-semibold truncate text-[11px]",o.textContent=i,o.title=i;const d=document.createElement("div");d.className="text-right text-zinc-300 tabular-nums font-medium",d.textContent=n.played;const l=document.createElement("div");l.className="text-right text-zinc-300 tabular-nums font-medium",l.textContent=n.games.size;const c=document.createElement("div");c.className="text-right text-zinc-300 tabular-nums font-medium",c.textContent=Math.round(n.exp).toLocaleString(),r.appendChild(o),r.appendChild(d),r.appendChild(l),r.appendChild(c),a.appendChild(r)}))}let C={};async function R(){C=await(await fetch("/data/keyword.json")).json()}function H(e,t){if(!t.trim())return e;if(!t.includes("=")){const n=t.toLowerCase();return e.filter(r=>{if((r.Game||"").toLowerCase().includes(n))return!0;const o=String(r.ID||"").toLowerCase();return(C[o]||[]).some(l=>l.includes(n))})}const a=t.replace(/[()]/g,"").split(",").map(n=>n.trim()).filter(Boolean);let i=e.slice();return a.forEach(n=>{const[r,s]=n.split("=").map(o=>o.trim().toLowerCase());r&&(r==="game"?i=i.filter(o=>{if((o.Game||"").toLowerCase().includes(s))return!0;const l=String(o.ID||"").toLowerCase();return(C[l]||[]).some(p=>p.includes(s))}):r==="genre"||r==="type"?i=i.filter(o=>String(o.Genres||"").toLowerCase().split(/[,;|]+/).map(l=>l.trim()).some(l=>l.includes(s))):r==="level"?i=i.filter(o=>{const d=parseFloat(String(o.BS||o.Level||"").replace(/[^\d\.\-]/g,""));return!isNaN(d)&&Math.floor(d)===parseInt(s,10)}):r==="id"?i=i.filter(o=>String(o.ID||"").toLowerCase()===s):r==="idl"&&(i=i.filter(o=>String(o.IDL||"").toLowerCase()===s)))}),i}let g=[],L=[];const b=20;let v=b;const m={container:document.getElementById("dataContainer"),searchInput:document.getElementById("searchInput"),hintToggle:document.getElementById("hintToggle"),searchHint:document.getElementById("searchHint"),genreTable:document.getElementById("genreTable")};function I(e,t=!1){if(t&&(m.container.innerHTML="",v=b),L=e,!e||e.length===0){m.container.innerHTML=`
      <div class="flex flex-col items-center justify-center py-20 gap-4">
        <p class="text-zinc-500">No levels found</p>
      </div>
    `;return}const a=document.createDocumentFragment();e.slice(m.container.children.length,v).forEach(i=>{a.appendChild(T(i))}),m.container.appendChild(a)}function U(e){const t=H(g,e);I(t,!0)}function P(){m.searchInput&&m.searchInput.addEventListener("input",t=>{U(t.target.value)}),m.hintToggle&&m.searchHint&&m.hintToggle.addEventListener("click",()=>{m.searchHint.classList.toggle("hidden")});const e=document.querySelector("main");e&&e.addEventListener("scroll",()=>{const{scrollTop:t,scrollHeight:a,clientHeight:i}=e;t+i>=a-150&&v<L.length&&(v+=b,I(L))})}async function O(){try{g=await k(),await R();const e=B(g);z(e),M(e.sortedGenres,e.genreStats),I(g,!0)}catch(e){console.error("Initialization error:",e),m.container.innerHTML='<p class="text-red-400">Error loading data</p>'}}document.addEventListener("DOMContentLoaded",()=>{P(),O()});
